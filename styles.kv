##########################################################
## Colors:
##   primary green: 24, 64, 70  -> 0.09, 0.25, 0.27 -> hex('#18453B')
##   bright green: 13, 177, 75 -> 0.05, 0.69, 0.29 -> hex('#0DB14B')
##   Lesser green:  0, 129, 131 -> 0.00, 0.51, 0.51 ->hex('#008183')
##   orange: 240, 133, 33 -> 0.94, 0.52, 0.129 ->hex('#F08521')
##   gold: 200, 154, 88 -> 0.78, 0.60, 0.35 ->hex('#C89A58')
##########################################################
#:import hex kivy.utils.get_color_from_hex

ScreenManagement:
    Main:
        id: Main_screen
        location: filechoose.load_location
        save_location: filechooser_save.save_location

        test_label:
        input_test:
        test_perc:
        train_perc:

        test_percentage:


    Loc:
        id: filechoose
    SaveLoc:
        id: filechooser_save


<SavePopup>:
    rows:4
    background_color: hex('#008183')
    separator_color: hex('#0DB14B')
    title_color: hex('#0DB14B')


    chk_save_estimates: chk_save_estimates
    chk_save_ROC: chk_save_ROC
    chk_save_testtrain: chk_save_testtrain
    chk_save_datamets: chk_save_datamets
    chk_save_analysis: chk_save_analysis
    chk_save_project: chk_save_project

    GridLayout:
        size_hint_y: 0.3
        rows: 2

        Label:
            text: 'SAVE PLOTS'
            bold: True

            color: hex('#0DB14B')

        GridLayout:
            rows: 2
            cols: 2

            CheckBox:
                size_hint_x: 0.1
                halign: 'right'
                id : chk_save_estimates
                color: hex('#0DB14B')
            Label:
                halign: 'left'
                size_hint_x: 0.9
                valign: 'middle'
                text_size: self.size
                text: 'Estimate Densities'
                color: 1,1,1,1

            CheckBox:
                halign: 'right'
                size_hint_x: 0.1
                id : chk_save_ROC
                color: hex('#0DB14B')
            Label:
                halign: 'left'
                size_hint_x: 0.9
                valign: 'middle'
                text_size: self.size
                text: 'FMNR vs FMR (ROC)'
                color: 1,1,1,1

    GridLayout:
        size_hint_y: 0.3
        rows: 2

        Label:
            text: 'SAVE DATA'
            bold: True
            color: hex('#0DB14B')
        GridLayout:
            rows: 3
            cols: 2

            CheckBox:
                halign: 'right'
                size_hint_x: 0.1
                id : chk_save_testtrain
                color: hex('#0DB14B')
            Label:
                halign: 'left'
                size_hint_x: 0.9
                valign: 'middle'
                text_size: self.size
                text: 'Training and Testing Data'
                color: 1,1,1,1

            CheckBox:
                halign: 'right'
                size_hint_x: 0.1
                id : chk_save_datamets
                color: hex('#0DB14B')
            Label:
                size_hint_x: 0.9
                halign: 'left'
                valign: 'middle'
                text_size: self.size
                text: 'Dataset Metrics (e.g. samples per class)'
                color: 1,1,1,1

            CheckBox:
                size_hint_x: 0.1
                halign: 'right'
                id : chk_save_analysis
                color: hex('#0DB14B')
            Label:
                size_hint_x: 0.9
                halign: 'left'
                valign: 'middle'
                text_size: self.size
                text: 'Evaluation Metrics'
                color: 1,1,1,1

    GridLayout:
        size_hint_y: 0.3
        rows: 2

        Label:
            text: 'SAVE Project'
            bold: True
            color: hex('#0DB14B')
        GridLayout:
            rows: 3
            cols: 2

            CheckBox:
                halign: 'right'
                size_hint_x: 0.1
                id : chk_save_project
                color: hex('#0DB14B')
            Label:
                halign: 'left'
                size_hint_x: 0.9
                valign: 'middle'
                text_size: self.size
                text: 'Save the project to be reloaded in the future.'
                color: 1,1,1,1

    Button:
        size_hint_y: 0.1
        text: 'Save Report'
        on_press:
            root.close()


<ResetPopup>:
    rows:2
    background_color: hex('#008183')
    separator_color: hex('#0DB14B')
    title_color: hex('#0DB14B')

    Label:
        size_hint_y: 0.9
        text: 'Choosing to Reset will delete everything this program has generated (it will not delete the data files unless you place them within the "generated" directory.) \n \n [b]Do you wish to continue?[/b]'

        padding_x:[50,50]
        text_size: self.width, None
        height: self.texture_size[1]

        color: hex('#0DB14B')
        markup: True

    GridLayout:
        cols: 2
        size_hint_y: 0.1

        Button:
            text: 'Save Instead'
            background_color: hex('#0DB14B')

            on_press:
                root.save_popup()
        Button:
            text: 'RESET'
            background_color: hex('#F08521')

            on_press:
                root.reset()
                root.close()



<DSigPopup>:
    rows:3
    background_color: hex('#008183')
    separator_color: hex('#0DB14B')
    title_color: hex('#0DB14B')

    Label:
        size_hint_y: 0.5
        text: 'Double Sigmoid Estimator requires variables t, r1, & r2. For more information, please see [b] Score normalization in multimodal biometric systems [/b] by Jain, Nandakumar, Ross.'

        text_size: self.width, None
        height: self.texture_size[1]

        color: hex('#0DB14B')
        markup: True

    GridLayout:
        size_hint_y: 0.1
        rows: 0
        cols: 6

        Label:
            text: 't: '
            bold: True

        TextInput:
            id: DSig_t
            text: '2'

        Label:
            text: 'r1: '
            bold: True

        TextInput:
            id: DSig_r1
            text: '4'

        Label:
            text: 'r2: '
            bold: True

        TextInput:
            id: DSig_r2
            text: '8'

    Button:
        size_hint_y: 0.1
        text: 'Set Parameters'

        on_press:
            root.set_dsig(DSig_t.text, DSig_r1.text, DSig_r2.text)
            root.close()


<TanhPopup>:
    rows:3
    background_color: hex('#008183')
    separator_color: hex('#0DB14B')
    title_color: hex('#0DB14B')

    Label:
        size_hint_y: 0.5
        text: 'Tanh Estimator requires variables a, b, & c to calculate the Hampel influence. For more information, please see [b] Score normalization in multimodal biometric systems [/b] by Jain, Nandakumar, Ross.'

        text_size: self.width, None
        height: self.texture_size[1]

        color: hex('#0DB14B')
        markup: True

    GridLayout:
        size_hint_y: 0.1
        rows: 0
        cols: 6

        Label:
            text: 'a: '
            bold: True

        TextInput:
            id: Tanh_a
            text: '2'

        Label:
            text: 'b: '
            bold: True

        TextInput:
            id: Tanh_b
            text: '4'

        Label:
            text: 'c: '
            bold: True

        TextInput:
            id: Tanh_c
            text: '8'



    Button:
        size_hint_y: 0.1
        text: 'Set Parameters'
        on_press:
            root.set_tanh(Tanh_a.text, Tanh_b.text, Tanh_c.text)
            root.close()


<SelectiveFusionPopup>:
    see_alpha: see_alpha
    rows:3
    background_color: hex('#008183')
    separator_color: hex('#0DB14B')
    title_color: hex('#0DB14B')

    GridLayout:
        rows: 3
        size_hint_y: 0.6

        Label:
            text: 'Perform fusion when a score is in the specified range of alpha to beta. Alpha and Beta should be selected to maximize the area which genuine and imposter overlap. The [b]Baseline [/b] modality is the set of scores to use unless score is in alpha-beta, in which case substitute the score with the average of all modalities. \n \n For example, consider the following estimate density plot: '
            size_hint_y: 0.4

            text_size: self.width, None
            height: self.texture_size[1]

            color: hex('#0DB14B')
            markup: True

        Image:
            source: './graphics/selection_demo.png'
            size_hint_y: 0.5
            #allow_stretch: True

        Label:
            size_hint_y: 0.1
            text: ''

    GridLayout:
        size_hint_y: 0.3
        rows: 4

        BoxLayout:
            size_hint_y: 0.3
            Label:
                size_hint_x: 0.3
                text: 'Baseline Modality: '
                bold: True

            Button:
                id: baseline
                size_hint_x: 0.7

                text: 'Select Baseline Modality'
                on_press:
                    root.show_dropdown(baseline)

        BoxLayout:
            size_hint_y: 0.2
            Label:
                text: ''

        GridLayout:
            rows: 2
            size_hint_y: 0.5

            GridLayout:
                cols: 2
                size_hint_y: 0.6

                CheckBox:
                    id: chk_auto_alpha
                    active: True
                    n_active: root.check_auto(self, self.active)
                    size_hint_x: 0.10
                    #color: 1, 1, 1, 1
                    color: hex('#0DB14B')

                Label:
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.width, None
                    size_hint_x: 0.9

                    markup: True
                    text: 'Attempt [b][u]Auto-Detect[/u][/b] Alpha and Beta'
                    color: hex('#0DB14B')


            BoxLayout:
                id: see_alpha
                size_hint_y: 0.4
                opacity: 0.0

                Label:
                    id: see_alpha_lbl
                    text: 'Alpha: '
                    bold: True

                TextInput:
                    id: Fuse_alpha
                    text: '0.0'

                Label:
                    id: see_beta_lbl
                    text: 'Beta: '
                    bold: True

                TextInput:
                    id: Fuse_beta
                    text: '0.0'

        BoxLayout:
            size_hint_y: 0.2
            Label:
                text: ''
    Button:
        size_hint_y: 0.1
        text: 'Set Parameters'
        background_color: hex('#0DB14B')
        on_press:
            root.set_parms(Fuse_alpha.text, Fuse_beta.text, baseline.text)
            root.close()


<Loc>:
    name: 'directory'
    background_color: (1, 1, 1, 1)    # White colour

    GridLayout:
        rows: 2

        FileChooserIconView:
            id: filechoose
            path: '.'

        BoxLayout:
            size_hint_y: 0.2

            Button:
                text: 'Select'
                size_hint_x: .5
                on_press:
                    root.change_text(filechoose.path)
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'mscreen'
                    # root.manager.get_screen('mscreen').setup()

            Button:
                text: 'Cancel'
                size_hint_x: .5
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'mscreen'
<SaveLoc>:
    name: 'save_directory'
    background_color: (1, 1, 1, 1)    # White colour

    GridLayout:
        rows: 2

        FileChooserIconView:
            id: filechooser_save
            save_path: '.'

        BoxLayout:
            size_hint_y: 0.2

            Button:
                text: 'Select'
                size_hint_x: .5
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'mscreen'
                    root.manager.get_screen('mscreen').save_report(filechooser_save.save_path)

            Button:
                text: 'Cancel'
                size_hint_x: .5
                on_press:
                    root.manager.transition.direction = 'right'
                    root.manager.current = 'mscreen'


<Main>:
    name: 'mscreen'
    id: 'Main_screen'


    test_label: test_label
    input_test: input_test

    chk_MinMax:chk_MinMax
    chk_ZScore:chk_ZScore
    chk_None: chk_None

    chk_Decimal:chk_Decimal
    chk_Median:chk_Median
    chk_DSigmoid: chk_DSigmoid
    chk_TanhEstimator: chk_TanhEstimator
    chk_Biweight: chk_Biweight


    chk_Test:chk_Test
    chk_Train:chk_Train
    chk_Entire: chk_Entire

    ##
    chk_selective: chk_selective
    chk_sum: chk_sum
    chk_svm: chk_svm


    # returned_modalities: returned_modalities
    detected_lbl: detected_lbl
    modalities_lbl: modalities_lbl

    d_slide: density_slider_id
    r_slide: roc_slider_id

    loading_pb: load_pb

    fixed_FMR_val: fixed_fmr




    TabbedPanel:
        size_hint: 1, 1
        pos_hint: {'center_x': .5, 'center_y': .5}
        do_default_tab: False
        tab_width: self.size[0]/len(self.tab_list)

        background_color: (1, 1, 1, 1)    # White colour
        background_image: 'path/to/background/image'

        color: hex('#18453B')
        ##########################################################
        ##########################################################
        ##########################################################
        ##########################################################
        # DATA
        ##########################################################

        TabbedPanelItem:
            id: tabby_tab
            text: 'Data'

            GridLayout:
                rows: 2
                cols: 2

                BoxLayout:
                    size_hint_x: 0.7
                    size_hint_y: 0.9
                    orientation: "vertical"
                    padding: 5

                    ################## Load Scores
                    GridLayout:
                        cols: 2
                        orientation: "vertical"
                        size_hint_y: 0.2

                        Button:
                            #size_hint_x: 0.3
                            #size_hint_y: 0.4
                            size: 150, 50
                            size_hint: None, None

                            text: 'Score Directory'
                            background_color: hex('#0DB14B')
                            color: 1, 1, 1, 1
                            on_press:
                                root.manager.transition.direction = 'left'
                                root.manager.current = 'directory'


                        Label:
                            id: location
                            size_hint: 0.7, None
                            height: self.texture_size[1]
                            color: hex('#0DB14B')

                            text_size: self.width, None


                            text: root.location



                    ################## Train/Test split info
                    GridLayout:
                        rows: 2
                        size_hint_y: 0.2

                        BoxLayout:
                            CheckBox:
                                #n_active: root.checkbox_click(self, self.active)
                                size_hint_x: 0.10
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.width, None
                                size_hint_x: 0.9

                                markup: True
                                text: 'These are [b]Dissimilarity[/b] Scores'
                                color: 0.0, 0.0, 0.0, 1

                        BoxLayout:
                            CheckBox:
                                n_active: root.checkbox_click(self, self.active)
                                size_hint_x: 0.10
                                active: True
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.width, None
                                size_hint_x: 0.9

                                text: 'This is the entire dataset'
                                color: 0.0, 0.0, 0.0, 1


                        BoxLayout:
                            padding: 40, 0
                            TextInput:
                                id: input_test
                                opacity: 0.0


                                halign: 'right'
                                valign: 'middle'
                                text_size: self.width, None
                                size_hint: (.15, None)
                                height: 30
                                text: str(root.test_perc)
                                multiline: False
                                on_text_validate: root.update_test((int(input_test.text)))

                            Label:
                                id: test_label
                                opacity: 0.0

                                halign: 'left'
                                valign: 'middle'
                                size_hint: (.9, .4)

                                text_size: self.width, None
                                text: root.train_perc
                                color: 0,0,0,1


                    ################## Normalize
                    GridLayout:
                        rows: 2
                        size_hint_y: 0.4
                        Label:
                            text: 'Normalization'
                            color: hex('#0DB14B')
                            halign: 'left'
                            text_size: self.size
                            bold: True

                        GridLayout:
                            rows: 2
                            cols: 8
                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_MinMax
                                active: True
                                color: hex('#0DB14B')


                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'MinMax'
                                color: 0,0,0,1

                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_ZScore
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'Z-Score'
                                color: 0,0,0,1

                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_Decimal
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'Decimal'
                                color: 0,0,0,1

                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_Median
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'Median&MAD'
                                color: 0,0,0,1

                        ##### Second Row
                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_DSigmoid
                                color: hex('#0DB14B')
                                on_active:
                                    root.DSig_popup()

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'Double Sigmoid'
                                color: 0,0,0,1

                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_TanhEstimator
                                color: hex('#0DB14B')
                                on_active:
                                    root.Tanh_popup()
                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'Tanh Estimator'
                                color: 0,0,0,1

                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_Biweight
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'Biweight Estimator'
                                color: 0,0,0,1

                            CheckBox:
                                group: 'norm'
                                halign: 'right'
                                id : chk_None
                                color: hex('#0DB14B')

                            Label:
                                halign: 'left'
                                valign: 'middle'
                                text_size: self.size
                                text: 'None'
                                color: 0,0,0,1

                    ##################
                    GridLayout:
                        rows: 2
                        size_hint_y: 0.1

                        Label:
                            text: 'Progress '
                            #size_hint_x: 0.2
                            #size_hint_y: None
                            #pos_hint: {"x":0,"y":0}
                            color: hex('#0DB14B')
                            text_size: self.size
                            bold: True

                        ProgressBar:
                            id: load_pb
                            min: 0
                            max: 100

                            # https://stackoverflow.com/questions/51719374/how-to-change-color-of-progress-bar-kivy
                            #canvas:
                            #    BorderImage:
                            #        border: (12, 12, 12, 12)
                            #        pos: self.x, self.center_y - 12
                            #        size: self.width, 24
                            #        source: '.graphics/PB-Base.png'
                            #    BorderImage:
                            #        border: [int(min(self.width * (self.value / float(self.max)) if self.max else 0, 12))] * 4
                            #        pos: self.x, self.center_y - 12
                            #        size: self.width * (self.value / float(self.max)) if self.max else 0, 24
                            #        source: '.graphics/PB-Done.png'

                ##################
                ################## right - top
                GridLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.9
                    rows: 2

                    Label:
                        id: detected_lbl
                        size_hint_y: 0.2
                        size_hint_x: 1
                        halign: 'center'
                        valign: 'top'
                        text_size: self.size

                        opacity: 1.0
                        text: '\n\nDetected Modalities'
                        bold: True
                        underline: True
                        color: hex('#18453B')

                        canvas.before:
                            Color:
                                rgba: 0.91, 0.93, 0.96, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size


                    Label:
                        id: modalities_lbl
                        size_hint_y: 0.8
                        valign: 'top'
                        halign: 'center'
                        text: root.returned_modalities
                        text_size: self.size
                        color: 0, 0, 0, 1

                        canvas.before:
                            Color:
                                rgba: 0.91, 0.93, 0.96, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size


                ##################
                ################## left - bottom
                BoxLayout:
                    size_hint_x: 0.7
                    size_hint_y: 0.1

                    Button:
                        text: 'Load Data'
                        background_color: hex('#0DB14B')
                        bold: True
                        on_press:
                            root.set_normalization()
                            root.setup_2(root.location)
                            # Main.tabby_tab.switch_to(Main.tab_list[2])
                            # https://stackoverflow.com/questions/38883763/kivy-button-on-press-switch-to-next-tab-using-kivy-builder
                ##################
                ################## right - bottom
                BoxLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.1

                    Button:
                        text: 'RESET'
                        background_color: hex('#F08521')
                        on_press:
                            root.reset_popup()
        ##########################################################
        ##########################################################
        ##########################################################
        ##########################################################
        ##########################################################
        # Create 2nd tab
        ##########################################################

        TabbedPanelItem:
            text: 'Estimate Densities'

            GridLayout:
                rows: 2
                cols: 2

                ##################
                ################## left - top
                BoxLayout:
                    size_hint_x: 0.7
                    size_hint_y: 0.9
                    orientation: "vertical"
                    padding: 10

                    Button: #TODO
                        #TODO
                        #TODO
                        #TODO
                        id: density_button
                        background_normal: ''
                        background_color: 1, 1, 1, 1

                        on_press:
                            root.update_density_type()
                            self.background_color = (0.8, 0.9, 0.8, 0.05)

                        Image:
                            id: display_image
                            pos_hint: {'center_x': 0.5, 'center_y': 1.5}

                            allow_stretch: True
                            source:root.display_path_density

                            size: self.parent.size
                            valign: 'top'


                ##################
                ################## right - top
                GridLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.9
                    rows: 9

                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        text_size: self.size
                        markup: True
                        text: root.msg_train
                        color: hex('#0DB14B')
                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        text_size: self.size
                        markup: True
                        text: root.msg_impgen_train
                        color: 0, 0, 0, 1

                    Label:
                        size_hint_y: 0.1


                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        valign: 'top'
                        text_size: self.size
                        markup: True
                        text: root.msg_test
                        color: hex('#0DB14B')

                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        valign: 'top'
                        text_size: self.size
                        markup: True
                        text: root.msg_impgen_test
                        color: 0, 0, 0, 1

                    Label:
                        size_hint_y: 0.1

                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        valign: 'top'
                        text_size: self.size
                        markup: True
                        text: root.msg_modalities
                        color: hex('#0DB14B')

                    Button:
                        size_hint_y: 0.01
                        background_color: hex('#0DB14B')

                        text: 'View Plots For:'
                        color: 1, 1, 1, 1

                    GridLayout:
                        size_hint_y: 0.29
                        rows: 3
                        cols: 2

                        CheckBox:
                            group: 'dens'
                            halign: 'left'
                            id : chk_Test
                            color: hex('#0DB14B')
                            on_active: root.set_density_set()


                        Label:
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                            text: 'Test Set'
                            color: 0,0,0,1

                        CheckBox:
                            group: 'dens'
                            halign: 'right'
                            id : chk_Train
                            color: hex('#0DB14B')
                            on_active: root.set_density_set()

                        Label:
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                            text: 'Train Set'
                            color: 0,0,0,1

                        CheckBox:
                            group: 'dens'
                            halign: 'right'
                            id : chk_Entire
                            color: hex('#0DB14B')
                            active:True
                            on_active: root.set_density_set()

                        Label:
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.size
                            text: 'Entire Set'
                            color: 0,0,0,1

                ##################
                ################## left - bottom
                GridLayout:
                    rows: 2
                    size_hint_x: 0.7
                    size_hint_y: 0.1


                    BoxLayout:
                        Label:
                            bold: True
                            size_hint_x: 0.2
                            text: 'Modalities: '
                            color: 0, 0, 0, 1
#################################################
                        Button:
                            size_hint_x: 0.1
                            background_color: 0, 0, 0, 0
                            on_press:
                                root.slider_button('left','density', int(density_slider_id.value))
                                if density_slider_id.value > 0: density_slider_id.value = density_slider_id.value - 1
                            Image:
                                source: './graphics/left.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                allow_stretch: True
                                size_hint_y: None  # Tells the layout to ignore the size_hint in y dir
                                height: dp(30)  # The fixed height you want


                        Slider:
                            id: density_slider_id
                            step: 1

                            size_hint_x: 0.6
                            on_value:
                                root.density_slider(int(density_slider_id.value))


                        Button:
                            size_hint_x: 0.1
                            background_color: 0, 0, 0, 0
                            on_press:
                                root.slider_button('right','density', int(density_slider_id.value))
                                if density_slider_id.value < root.num_mods-1: density_slider_id.value = density_slider_id.value + 1
                            Image:
                                source: './graphics/right.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                allow_stretch: True
                                size_hint_y: None  # Tells the layout to ignore the size_hint in y dir
                                height: dp(30)  # The fixed height you want
                ##################
                ################## right - bottom
                BoxLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.1

                    Button:
                        text: 'SAVE'
                        background_color:  hex('#0DB14B')
                        on_press:
                            root.manager.transition.direction = 'left'
                            root.manager.current = 'SaveDirectory'
                            root.save_popup()

        ##########################################################
        ##########################################################
        ##########################################################
        ##########################################################
        # Create 3rd tab
        TabbedPanelItem:
            text: 'Fusion'
            GridLayout:
                rows: 2
                cols: 2

                ##################
                ################## left - top
                GridLayout:
                    size_hint_x: 0.7
                    size_hint_y: 0.9

                    cols: 2
                    CheckBox:
                        id: chk_selective
                        size_hint_x: 0.2
                        color: hex('#0DB14B')
                        n_active: root.selective_fusion_click(self, self.active)

                    Label:
                        text: 'Selective Fusion'
                        size_hint_x: 0.8
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.width, None
                        color: hex('#0DB14B')

                    CheckBox:
                        id: chk_sum
                        size_hint_x: 0.2
                        color: hex('#0DB14B')

                    Label:
                        text: 'Sum Fusion'
                        size_hint_x: 0.8
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.width, None
                        color: hex('#0DB14B')


                    CheckBox:
                        id: chk_svm
                        size_hint_x: 0.2
                        color: hex('#0DB14B')

                    Label:
                        text: 'SVM Fusion'
                        size_hint_x: 0.8
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.width, None
                        color: hex('#0DB14B')


                    CheckBox:
                        id: chk_weighted_sum
                        size_hint_x: 0.2
                        color: hex('#0DB14B')

                    Label:
                        text: 'Weighted Sum Fusion'
                        size_hint_x: 0.8
                        halign: 'left'
                        valign: 'middle'
                        text_size: self.width, None
                        color: hex('#0DB14B')



                ##################
                ################## right - top
                GridLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.9
                    rows: 9



                ##################
                ################## left - bottom
                GridLayout:
                    rows: 2
                    size_hint_x: 0.7
                    size_hint_y: 0.1

                    BoxLayout:


                ##################
                ################## right - bottom
                BoxLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.1

                    Button:
                        text: 'FUSE SCORES'
                        background_color:  hex('#0DB14B')
                        on_press:
                            root.fuse()

        ##########################################################
        ##########################################################
        ##########################################################
        ##########################################################
        # Create 4rd tab
        ##########################################################

        TabbedPanelItem:
            text: 'Results and Analysis'

            GridLayout:
                rows: 2
                cols: 2

                ##################
                ################## left - top
                BoxLayout:
                    size_hint_x: 0.7
                    size_hint_y: 0.9
                    orientation: "vertical"
                    padding: 5

                    Image:
                        id: display_image_roc
                        source: root.display_path_roc


                ##################
                ################## right - top
                GridLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.9
                    rows: 6

                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        text_size: self.size
                        markup: True
                        text: '[b]AUC Accuracy[/b]'
                        color: hex('#0DB14B')

                    Label:
                        size_hint_y: 0.2
                        halign: 'left'
                        valign: 'top'
                        text_size: self.size
                        markup: True
                        text: root.msg_accuracy
                        color: 0, 0, 0, 1


                    Label:
                        size_hint_y: 0.1
                        halign: 'left'
                        text_size: self.size
                        markup: True
                        text: '[b]Equal Error Rate[/b]'
                        color: hex('#0DB14B')
                    Label:
                        size_hint_y: 0.2
                        halign: 'left'
                        valign: 'top'
                        text_size: self.size
                        markup: True
                        text: root.msg_eer
                        color: 0, 0, 0, 1
                    # TODO
                    # TODO
                    # TODO
                    # TODO
                    # TODO
                    # TODO
                    GridLayout:
                        rows: 3
                        size_hint_y: 0.4

                        Label:
                            size_hint_y: 0.2
                            halign: 'left'
                            text_size: self.size
                            markup: True
                            text: '[b]Estimated TMR[/b]'
                            color: hex('#0DB14B')

                        GridLayout:
                            cols: 2
                            size_hint_y: 0.2

                            Label:
                                text: '@ fixed FMR'
                                color: 0, 0, 0, 1
                                bold: True

                            TextInput:
                                id: fixed_fmr
                                text: '0.01'
                                multiline: False

                                halign: 'right'
                                valign: 'middle'
                                text_size: self.width, None
                                size_hint: (.65, None)
                                height: 30
                                multiline: False
                                on_text_validate: root.update_evals()


                        Label:
                            size_hint_y: 0.6
                            halign: 'left'
                            valign: 'top'
                            text_size: self.size
                            markup: True
                            text: root.msg_fixed_tmr
                            color: 0, 0, 0, 1

                ##################
                ################## left - bottom
                GridLayout:
                    rows: 2
                    size_hint_x: 0.7
                    size_hint_y: 0.1

                    BoxLayout:
                        Label:
                            bold: True
                            size_hint_x: 0.3
                            text: 'ROC Plot: '
                            color: 0, 0, 0, 1

#################################################
                        Button:
                            size_hint_x: 0.1
                            background_color: 0, 0, 0, 0
                            on_press:
                                root.slider_button('left','roc', int(roc_slider_id.value))
                                if roc_slider_id.value > 0: roc_slider_id.value = roc_slider_id.value - 1
                            Image:
                                source: './graphics/left.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                allow_stretch: True
                                size_hint_y: None  # Tells the layout to ignore the size_hint in y dir
                                height: dp(30)  # The fixed height you want

                        Slider:
                            id: roc_slider_id
                            value: int(root.roc_index)

                            min: 0
                            max: root.current_roc_nums
                            step: 1

                            size_hint_x: 0.6
                            on_value: root.roc_slider(int(roc_slider_id.value))


                        Button:
                            size_hint_x: 0.1
                            background_color: 0, 0, 0, 0
                            on_press:
                                root.slider_button('right','roc', density_slider_id.value)
                                if roc_slider_id.value < root.current_roc_nums - 1: roc_slider_id.value = roc_slider_id.value + 1
                            Image:
                                source: './graphics/right.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                allow_stretch: True
                                size_hint_y: None  # Tells the layout to ignore the size_hint in y dir
                                height: dp(30)  # The fixed height you want


                ##################
                ################## right - bottom
                BoxLayout:
                    size_hint_x: 0.3
                    size_hint_y: 0.1

                    Button:
                        text: 'SAVE'
                        background_color:  hex('#0DB14B')
                        on_press:
                            root.save_popup()
                            root.manager.transition.direction = 'left'
                            root.manager.current = 'save_directory'